name: CI
on: [push, pull_request]

jobs:
  ci:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: shivammathur/setup-php@v2
        with:
          php-version: '8.3'
          coverage: none
      - run: composer install --no-interaction --no-progress
      - run: cp .env.example .env && php artisan key:generate
      - name: CS Fixer (dry-run)
        run: vendor/bin/php-cs-fixer fix --dry-run --diff
      - name: PHPStan (Larastan)
        run: vendor/bin/phpstan analyse --no-progress
      - name: Lint OpenAPI
        run: |
          docker run --rm -v "$PWD:/work" node:20-alpine sh -lc "npm i -g @redocly/cli && redocly lint /work/openapi.yaml"
